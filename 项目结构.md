# AI Dialer Mini 项目结构

## 项目目录结构
```
ai_dialer_mini/
├── cmd/                    # 应用程序入口
│   └── main.go            # 主程序入口文件
├── internal/              # 内部包
│   ├── config/            # 配置相关
│   │   ├── config.go      # 基础配置结构
│   │   └── freeswitch.go  # FreeSWITCH配置
│   ├── service/           # 业务逻辑层
│   │   ├── asr/          # 语音识别服务
│   │   │   ├── xfyun.go  # 科大讯飞ASR实现
│   │   │   └── types.go  # ASR相关类型定义
│   │   └── fs/           # FreeSWITCH服务
│   │       ├── client.go # ESL客户端实现
│   │       └── types.go  # FreeSWITCH相关类型定义
│   └── handler/          # 业务处理层
│       └── call.go       # 通话相关处理逻辑
├── pkg/                  # 可复用的公共包
│   ├── logger/          # 日志工具
│   │   └── logger.go    # 日志实现
│   └── utils/           # 通用工具
│       └── utils.go     # 工具函数
├── configs/             # 配置文件目录
│   └── config.yaml      # 应用配置文件
├── scripts/            # 脚本文件目录
│   └── setup.sh       # 环境设置脚本
├── iat_ws_go_demo/    # 科大讯飞Demo参考
│   └── iat_ws_go_demo.go # 原始Demo代码
├── go.mod             # Go模块文件
├── go.sum             # Go依赖校验文件
└── README.md          # 项目说明文档

## 主要功能模块说明

### 1. FreeSWITCH服务 (internal/service/fs)
- 负责与FreeSWITCH服务器的ESL连接
- 处理通话事件
- 提供拨号等基础电话功能

### 2. ASR服务 (internal/service/asr)
- 集成科大讯飞的语音识别服务
- 实时语音转文字功能
- 语音识别结果处理

### 3. 业务处理层 (internal/handler)
- 处理通话业务逻辑
- 协调FreeSWITCH和ASR服务
- 实现实时语音识别功能

### 4. 配置管理 (internal/config)
- 管理FreeSWITCH连接配置
- 管理科大讯飞ASR配置
- 其他系统配置

### 5. 日志管理 (pkg/logger)
- 统一的日志记录接口
- 支持不同级别的日志
- 日志文件管理

## 技术栈
- Go 1.20+
- FreeSWITCH ESL
- 科大讯飞 WebAPI
- WebSocket

## 科大讯飞ASR集成说明

### Demo参考
项目中包含了科大讯飞官方的WebAPI Demo (`iat_ws_go_demo/iat_ws_go_demo.go`)，主要功能：
- WebSocket连接建立与鉴权
- 音频数据分帧发送
- 实时语音识别结果处理
- 支持的音频格式：audio/L16;rate=16000
- 支持的语言：中文（普通话）

### 核心功能
从Demo中我们提取并优化了以下核心功能：
1. 鉴权处理
   - HMAC-SHA256签名
   - WebSocket URL组装
   
2. 音频处理
   - 分帧处理（帧大小：1280字节）
   - 发送间隔（40ms）
   
3. 识别结果处理
   - 实时结果解析
   - 状态管理（首帧、中间帧、尾帧）

### 改进优化
相对于Demo，我们的实现做了以下改进：
1. 结构化的代码组织
2. 完善的错误处理
3. 支持多路会话
4. 实时音频流处理
5. 内存优化